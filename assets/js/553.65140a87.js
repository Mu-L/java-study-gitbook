(window.webpackJsonp=window.webpackJsonp||[]).push([[553],{931:function(t,a,s){"use strict";s.r(a);var r=s(26),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"minio入门-minio断点续传和断点下载实现方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#minio入门-minio断点续传和断点下载实现方案"}},[t._v("#")]),t._v(" Minio入门-Minio断点续传和断点下载实现方案")]),t._v(" "),s("h2",{attrs:{id:"_1-前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言"}},[t._v("#")]),t._v(" 1. 前言")]),t._v(" "),s("p",[t._v("在之前，我们实现了常用的上传下载、分片上传、秒传等功能，实际一个文件存储管理系统，这些远远还是不够的，比如断点续传。")]),t._v(" "),s("p",[t._v("可以参考阿里的文档，是怎么实现这些功能的。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://help.aliyun.com/document_detail/84785.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里OSS开发文档"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_2-断点续传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-断点续传"}},[t._v("#")]),t._v(" 2. 断点续传")]),t._v(" "),s("h3",{attrs:{id:"_2-1-概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-概念"}},[t._v("#")]),t._v(" 2.1 概念")]),t._v(" "),s("p",[t._v("通过断点续传上传的方式将文件上传到OSS前，您可以指定断点记录点。上传过程中，如果出现网络异常或程序崩溃导致文件上传失败时，将从断点记录处继续上传未上传完成的部分。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-方案"}},[t._v("#")]),t._v(" 2.2 方案")]),t._v(" "),s("p",[t._v("要实现断点续传，需要依赖于MD5秒传和分片上传。之前我们分片上传的简单流程如下图所示，我们可以在这个流程中加入端点续传。\n"),s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220724210700258.png",alt:"image-20220724210700258"}})]),t._v(" "),s("h4",{attrs:{id:"_2-2-1-文件状态查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-文件状态查询"}},[t._v("#")]),t._v(" 2.2.1 文件状态查询")]),t._v(" "),s("p",[t._v("首先上传文件之前，除了创建分片请求之外、获取uploadId之外，还需要在根据文件的MD5去查询该数据的状态，比如是已上传过、上传了一部分、上传完成、上传失败等。")]),t._v(" "),s("p",[t._v("如果该文件已上传过则直接返回访问链接。")]),t._v(" "),s("h4",{attrs:{id:"_2-2-2-查询已上传分片信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-查询已上传分片信息"}},[t._v("#")]),t._v(" 2.2.2 查询已上传分片信息")]),t._v(" "),s("p",[t._v("如果是上传失败，则查询根据该文件uploadId 查询已上传的分片信息，Minio 是支持这种查询的，比如下图中就可查到分片的相关信息：\n"),s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220724210757660.png",alt:"image-20220724210757660"}})]),t._v(" "),s("h4",{attrs:{id:"_2-2-3-继续上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-继续上传"}},[t._v("#")]),t._v(" 2.2.3. 继续上传")]),t._v(" "),s("p",[t._v("对于已上传的分片，获取链接时，直接返回该分片已上传，前端根据状态去判断跳过该分片上传，执行未上传分片的请求，这样就能做到断点续传了。")]),t._v(" "),s("h2",{attrs:{id:"_3-断点下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-断点下载"}},[t._v("#")]),t._v(" 3. 断点下载")]),t._v(" "),s("p",[t._v("当下载大文件时，如果网络不稳定或者程序异常退出，会导致下载失败，甚至重试多次仍无法完成下载。")]),t._v(" "),s("p",[t._v("为此，OSS需要提供了断点续传下载功能。断点续传下载将需要下载的文件分成若干个分片分别下载，所有分片都下载完成后，将所有分片合并成完整的文件。")]),t._v(" "),s("p",[t._v("在Minio中的java SDK 中是提供了对象数据查询的API，可以查看到对象的数据大小信息。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220724210915900.png",alt:"image-20220724210915900"}})]),t._v(" "),s("p",[t._v("知道文件大小之后，我们就可以进行切片，比如100M的大小，按照5M进行切分为20片，计算出每一片的起始位置和长度，Minio 获取文件的API 是支持分段获取流的。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220724210943891.png",alt:"image-20220724210943891"}})]),t._v(" "),s("p",[t._v("在实现了上述的分片下载后，就可以实现断点下载了，原理和上传一样，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220724211002451.png",alt:"image-20220724211002451"}})]),t._v(" "),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://yunyanchengyu.blog.csdn.net/article/details/123522111",target:"_blank",rel:"noopener noreferrer"}},[t._v("Minio入门系列【19】断点续传和断点下载实现方案"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);