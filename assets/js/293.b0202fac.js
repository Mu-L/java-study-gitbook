(window.webpackJsonp=window.webpackJsonp||[]).push([[293],{670:function(t,a,n){"use strict";n.r(a);var s=n(26),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"druid源码学习-一-druiddatasource数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#druid源码学习-一-druiddatasource数据结构"}},[t._v("#")]),t._v(" Druid源码学习（一）-DruidDataSource数据结构")]),t._v(" "),n("h2",{attrs:{id:"_1-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[t._v("#")]),t._v(" 1. 简介")]),t._v(" "),n("p",[t._v("DruidDataSource是DruidCP最关键的类之一，承载了连接池的启动、关闭、以及连接的获取和管理等功能。")]),t._v(" "),n("h2",{attrs:{id:"_2-druiddatasource的数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-druiddatasource的数据结构"}},[t._v("#")]),t._v(" 2. DruidDataSource的数据结构")]),t._v(" "),n("p",[t._v("DruidDataSource 其内部关键的的数据结构如下表:")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("name")]),t._v(" "),n("th",[t._v("type")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("connections")]),t._v(" "),n("td",[t._v("volatile DruidConnectionHolder[]")]),t._v(" "),n("td",[t._v("pool的关键数组，存放连接，实际上是DruidConnectionHolder的数组。Connection由DruidConnectionHolder持有")])]),t._v(" "),n("tr",[n("td",[t._v("evictConnections")]),t._v(" "),n("td",[t._v("DruidConnectionHolder[]")]),t._v(" "),n("td",[t._v("被驱逐的Connection的pool,调用收缩方法shrink之后，被收缩的连接都会进入这个数组。")])]),t._v(" "),n("tr",[n("td",[t._v("keepAliveConnections")]),t._v(" "),n("td",[t._v("DruidConnectionHolder[]")]),t._v(" "),n("td",[t._v("收缩方法shrink中，满足keepalive状态的连接都进入这个数组。")])]),t._v(" "),n("tr",[n("td",[t._v("autoFilters")]),t._v(" "),n("td",[t._v("static List")]),t._v(" "),n("td",[t._v("这个list存全部的filter")])]),t._v(" "),n("tr",[n("td",[t._v("enable")]),t._v(" "),n("td",[t._v("volatile boolean")]),t._v(" "),n("td",[t._v("默认值为true,标识连接池是否可用，调用close方法设置该值为false,当为false的时候，连接的error次数增加1,get连接或者其他操作会失败。")])]),t._v(" "),n("tr",[n("td",[t._v("inited")]),t._v(" "),n("td",[t._v("volatile boolean")]),t._v(" "),n("td",[t._v("默认值为false,初始化完成的标识。")])]),t._v(" "),n("tr",[n("td",[t._v("closing")]),t._v(" "),n("td",[t._v("volatile boolean")]),t._v(" "),n("td",[t._v("关闭过程中的状态。正在close")])])])]),t._v(" "),n("p",[n("strong",[t._v("连接池最关键的数据结构是内部持有DruidConnectionHolder的数组，connections。")])]),t._v(" "),n("h2",{attrs:{id:"_3-druidconnectionholder的数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-druidconnectionholder的数据结构"}},[t._v("#")]),t._v(" 3. DruidConnectionHolder的数据结构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("name")]),t._v(" "),n("th",[t._v("type")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("dataSource")]),t._v(" "),n("td",[t._v("final DruidAbstractDataSource")]),t._v(" "),n("td",[t._v("指向DataSource的指针。")])]),t._v(" "),n("tr",[n("td",[t._v("conn")]),t._v(" "),n("td",[t._v("final Connection")]),t._v(" "),n("td",[t._v("指向真正的数据库连接，由数据库驱动实现。")])]),t._v(" "),n("tr",[n("td",[t._v("connectionId")]),t._v(" "),n("td",[t._v("final long")]),t._v(" "),n("td",[t._v("连接编号。")])]),t._v(" "),n("tr",[n("td",[t._v("connectionEventListeners")]),t._v(" "),n("td",[t._v("final List")]),t._v(" "),n("td",[t._v("连接事件监听器。")])]),t._v(" "),n("tr",[n("td",[t._v("statementEventListeners")]),t._v(" "),n("td",[t._v("final List")]),t._v(" "),n("td",[t._v("statement事件监听器。")])]),t._v(" "),n("tr",[n("td",[t._v("statementPool")]),t._v(" "),n("td",[t._v("PreparedStatementPool")]),t._v(" "),n("td",[t._v("其内部是一个LRUCache，对Statement做缓存。")])]),t._v(" "),n("tr",[n("td",[t._v("statementTrace")]),t._v(" "),n("td",[t._v("final List")]),t._v(" "),n("td",[t._v("一个对Statement进行追踪的list,这个statementTrace的作用后面需要详细看看。")])])])]),t._v(" "),n("p",[t._v("DruidConnectionHolder是连接池中物理连接的载体，在DruidDataSource中，获取连接的getConnection方法，拿到的是DruidPooledConnection。")]),t._v(" "),n("h2",{attrs:{id:"_4-获取连接-getconnection"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-获取连接-getconnection"}},[t._v("#")]),t._v(" 4. 获取连接 getConnection")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidPooledConnection")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SQLException")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxWait"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidPooledConnection")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" maxWaitMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SQLException")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行初始化")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果filter存在 则执行filter,通过filter的代理类来得到连接。")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//filter的chain")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterChainImpl")]),t._v(" filterChain "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterChainImpl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" filterChain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dataSource_connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxWaitMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果filter不存在，则直接获取连接。")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnectionDirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxWaitMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("最终得到connection的方法：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("poolableConnection "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnectionInternal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxWaitMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这个方法中，也是根据DruidConnectionHolder产生连接池：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidPooledConnection")]),t._v(" poolalbeConnection "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidPooledConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" poolalbeConnection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("查看这个构造函数：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidPooledConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidConnectionHolder")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConnection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("holder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        dupCloseLogEnable "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDataSource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDupCloseLogEnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ownerThread "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        connectedTimeMillis "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("实际上DruidPooledConnection内部持有了一个DruidConnectionHolder。\nDruidPooledConnection的数据结构如下表：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("name")]),t._v(" "),n("th",[t._v("type")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("conn")]),t._v(" "),n("td",[t._v("Connection")]),t._v(" "),n("td",[t._v("指向真实的数据库连接。")])]),t._v(" "),n("tr",[n("td",[t._v("holder")]),t._v(" "),n("td",[t._v("volatile DruidConnectionHolder")]),t._v(" "),n("td",[t._v("指向DruidConnectionHolder。")])]),t._v(" "),n("tr",[n("td",[t._v("transactionInfo")]),t._v(" "),n("td",[t._v("TransactionInfo")]),t._v(" "),n("td",[t._v("事务相关的信息")])])])]),t._v(" "),n("h2",{attrs:{id:"_5-类关系图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-类关系图"}},[t._v("#")]),t._v(" 5. 类关系图")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220517224826098.png",alt:"image-20220517224826098"}})]),t._v(" "),n("p",[t._v("DruidConnectionHolder与DruidPooledConnection，实际上是对连接进行了分层。将频繁变更的内容抽象到了DruidConnectionHolder类。\n而DruidPooledConnection则存放了Statement的的缓存pool。")]),t._v(" "),n("h2",{attrs:{id:"_6-相关知识点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-相关知识点"}},[t._v("#")]),t._v(" 6. 相关知识点")]),t._v(" "),n("h3",{attrs:{id:"_6-1-volatile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-volatile"}},[t._v("#")]),t._v(" 6.1 volatile")]),t._v(" "),n("p",[n("code",[t._v("volatile")]),t._v(" 在druid 中也非常常用")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// store")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DruidConnectionHolder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" connections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v("                 closing                   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v("                 closed                    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-1-1-volatile-简介与作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-1-volatile-简介与作用"}},[t._v("#")]),t._v(" 6.1.1 "),n("code",[t._v("volatile")]),t._v(" 简介与作用")]),t._v(" "),n("p",[n("code",[t._v("volatile")]),t._v('通常被比喻成"轻量级的'),n("code",[t._v("synchronized")]),t._v("，"),n("code",[t._v("synchronized")]),t._v("可以保证原子性、有序性和可见性。而"),n("code",[t._v("volatile")]),t._v("却只能保证有序性和可见性（不保证原子性）。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，这新值对其他线程来说是立即可见的。")])]),t._v(" "),n("li",[n("p",[t._v("禁止进行指令重排序。")])])]),t._v(" "),n("h4",{attrs:{id:"_6-1-2-什么场景下使用volatile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-2-什么场景下使用volatile"}},[t._v("#")]),t._v(" 6.1.2 什么场景下使用"),n("code",[t._v("volatile")])]),t._v(" "),n("p",[t._v("在以下两个场景中可以使用"),n("code",[t._v("volatile")]),t._v("来代替"),n("code",[t._v("synchronized")]),t._v("：")]),t._v(" "),n("blockquote",[n("p",[t._v("1、运算结果并不依赖变量的当前值，或者能够确保只有单一的线程会修改变量的值。")]),t._v(" "),n("p",[t._v("2、变量不需要与其他状态变量共同参与不变约束。")])]),t._v(" "),n("h2",{attrs:{id:"参考文章"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/dhaibo1986/article/details/121215459?spm=1001.2014.3001.5501",target:"_blank",rel:"noopener noreferrer"}},[t._v("Druid源码阅读1-DruidDataSource数据结构"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);