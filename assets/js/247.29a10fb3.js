(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{623:function(s,a,t){"use strict";t.r(a);var e=t(26),l=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"如何调优慢查询sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何调优慢查询sql"}},[s._v("#")]),s._v(" 如何调优慢查询SQL")]),s._v(" "),t("h2",{attrs:{id:"_1-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1. 简介")]),s._v(" "),t("p",[s._v("我们在写程序的时候如何定位并优化慢查询呢？具体场景具体分析，大体思路如下")]),s._v(" "),t("ol",[t("li",[s._v("根据慢日志定位慢查询sql")]),s._v(" "),t("li",[s._v("使用explain等工具分析sql")]),s._v(" "),t("li",[s._v("修改sql或者尽量让sql走索引")])]),s._v(" "),t("h2",{attrs:{id:"_2-根据慢日志定位慢查询sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-根据慢日志定位慢查询sql"}},[s._v("#")]),s._v(" 2. 根据慢日志定位慢查询sql")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("查看慢日志配置情况")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" VARIABLES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%query%'")]),s._v("\n")])])]),t("p",[s._v("结果如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405231229429.png",alt:"image-20210405231229429"}})])])]),s._v(" "),t("ul",[t("li",[s._v("Long_query_time: 默认是10s就算是慢日志了")]),s._v(" "),t("li",[s._v("Show_query_log: 慢日志的开启状态")]),s._v(" "),t("li",[s._v("show_query_log_file: 慢日志所在的地址")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[s._v("慢日志的数量")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow_queries%'")]),s._v("\n")])])]),t("p",[s._v("结果如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405231632132.png",alt:"image-20210405231632132"}})])]),s._v(" "),t("li",[t("p",[s._v("慢日志打开")]),s._v(" "),t("ul",[t("li",[s._v("方式一：会话中更改（重启后会恢复默认）")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#慢日志打开")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" slow_query_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#慢查询的时间设置成1s")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v("  long_query_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("结果如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405231723049.png",alt:"image-20210405231723049"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405231849634.png",alt:"image-20210405231849634"}})])])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("方式二：修改配置文件（重启后配置还在）")]),s._v(" "),t("p",[s._v("修改配置文件my.cnf，在[mysqld]下的下方加入")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\nslow_query_log = ON\nlong_query_time = 1\n")])])])])]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[s._v("重启MySQL服务")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("service mysqld restart\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查看设置后的参数")]),s._v(" "),t("p",[s._v("show VARIABLES like '%query%'")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405233551896.png",alt:"image-20210405233551896"}})])]),s._v(" "),t("li",[t("p",[s._v("查看慢日志")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /var/lib/mysql/iZwz914d1peizv4h7laju4Z-slow.log\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234141934.png",alt:"image-20210405234141934"}})])])]),s._v(" "),t("h2",{attrs:{id:"_3-使用explain等工具分析sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用explain等工具分析sql"}},[s._v("#")]),s._v(" 3. 使用explain等工具分析sql")]),s._v(" "),t("ol",[t("li",[s._v("在查询语句前面加上explain")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234252604.png",alt:"image-20210405234252604"}})]),s._v(" "),t("p",[s._v("其中两个字段非常重要")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("type：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234357173.png",alt:"image-20210405234357173"}})])]),s._v(" "),t("li",[t("p",[s._v("extra：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234420498.png",alt:"image-20210405234420498"}})])])]),s._v(" "),t("h2",{attrs:{id:"_4-修改sql或者尽量让sql走索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改sql或者尽量让sql走索引"}},[s._v("#")]),s._v(" 4. 修改sql或者尽量让sql走索引")]),s._v(" "),t("h3",{attrs:{id:"_4-1-方案一-查询其他有索引的字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-方案一-查询其他有索引的字段"}},[s._v("#")]),s._v(" 4.1 方案一：查询其他有索引的字段")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234611399.png",alt:"image-20210405234611399"}})]),s._v(" "),t("h3",{attrs:{id:"_4-2-方案二-添加索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-方案二-添加索引"}},[s._v("#")]),s._v(" 4.2 方案二：添加索引")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210405234645956.png",alt:"image-20210405234645956"}})])])}),[],!1,null,null,null);a.default=l.exports}}]);