(window.webpackJsonp=window.webpackJsonp||[]).push([[666],{1043:function(s,a,t){"use strict";t.r(a);var r=t(26),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"chinahrss微服务docker化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chinahrss微服务docker化"}},[s._v("#")]),s._v(" chinahrss微服务Docker化")]),s._v(" "),t("h2",{attrs:{id:"_1-项目打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-项目打包"}},[s._v("#")]),s._v(" 1.项目打包")]),s._v(" "),t("p",[s._v("项目根目录下执行")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mvn clean package -Dmaven.test.skip=true\n")])])]),t("p",[s._v("每个微服务（除了聚合模块）target目录下会有个可运行jar包，比如chinahrss-auth模块：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200129201147695.png",alt:"image-20200129201147695"}})]),s._v(" "),t("h2",{attrs:{id:"_2-服务器创建相关目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器创建相关目录"}},[s._v("#")]),s._v(" 2. 服务器创建相关目录")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir -p /chinahrss/chinahrss-auth /chinahrss/chinahrss-gateway \\\n/chinahrss/chinahrss-monitor-admin /chinahrss/zipkin-server /chinahrss/chinahrss-register \\\n/chinahrss/chinahrss-server-system /chinahrss/chinahrss-server-test\n")])])]),t("h2",{attrs:{id:"_3-对文件夹授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-对文件夹授权"}},[s._v("#")]),s._v(" 3. 对文件夹授权")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chmod 777 -R /chinahrss\n")])])]),t("h2",{attrs:{id:"_4-将jar上传到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-将jar上传到服务器"}},[s._v("#")]),s._v(" 4. 将jar上传到服务器")]),s._v(" "),t("p",[s._v("将文件上传到对应目录下，如本地的"),t("code",[s._v("chinahrss-auth-0.0.1-SNAPSHOT.jar")]),s._v(" 就上传到 "),t("code",[s._v("/chinahrss/chinahrss-auth")])]),s._v(" "),t("p",[s._v("上传好后，运行一下目录，看是否都上传成功：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ls /chinahrss/chinahrss-auth /chinahrss/chinahrss-gateway \\\n/chinahrss/chinahrss-monitor-admin /chinahrss/zipkin-server /chinahrss/chinahrss-register \\\n/chinahrss/chinahrss-server-system /chinahrss/chinahrss-server-test\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200129202700966.png",alt:"image-20200129202700966"}})]),s._v(" "),t("h2",{attrs:{id:"_5-构建docker镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-构建docker镜像"}},[s._v("#")]),s._v(" 5. 构建Docker镜像")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("/chinahrss/chinahrss-auth")]),s._v(" 模块下创建一个Dockerfile")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200129203014295.png",alt:"image-20200129203014295"}})]),s._v(" "),t("p",[s._v("内容如下所示：")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8u212"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" zsz 312905679@qq.com\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" chinahrss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT.jar /chinahrss/chinahrss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT.jar\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx256m"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/chinahrss/chinahrss-auth-1.0-SNAPSHOT.jar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("上面脚本包含4条命令：")]),s._v(" "),t("ol",[t("li",[t("p",[t("code",[s._v("FROM openjdk:8u212-jre")])]),s._v(" "),t("p",[s._v("表示由"),t("code",[s._v("openjdk:8u212-jre")]),s._v("基础镜像构建。因为我们的项目使用的是JDK 1.8，所以我们要依赖于1.8版本的JDK镜像构建，openjdk官方Docker镜像仓库为https://hub.docker.com/_/openjdk?tab=tags，我挑了个体积相对较小的openjdk:8u212-jre；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("MAINTAINER zsz 312905679@qq.com")])]),s._v(" "),t("p",[s._v("指定镜像的作者及联系方式；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("COPY chinahrss-auth-1.0-SNAPSHOT.jar /chinahrss/chinahrss-auth-1.0-SNAPSHOT.jar")])]),s._v(" "),t("p",[s._v("表示将当前目录（/chinahrss/chinahrss-auth）下的chinahrss-auth-1.0-SNAPSHOT.jar拷贝到"),t("code",[s._v("openjdk:8u212-jre")]),s._v("镜像里的/chinahrss目录下，名称也为chinahrss-auth-0.0.1-SNAPSHOT.jar；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v('ENTRYPOINT ["java", "-Xmx256m", "-jar", "/febs/febs-auth-1.0-SNAPSHOT.jar"]')])]),s._v(" "),t("p",[s._v("表示运行"),t("code",[s._v("java -jar")]),s._v("运行镜像里的jar包，JVM内存最大分配为256m（因为要运行的微服务较多并且虚拟机内存只有6GB，所以内存分配小了点，实际可以根据宿主服务器的配置做出相应调整）。")])])]),s._v(" "),t("p",[s._v("DockerFile创建好后，在/chinahrss/chinahrss-auth目录下运行以下命令构建镜像：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker build -t chinahrss-auth:v1 .\n")])])]),t("p",[s._v("第一次构建的时候因为要下载"),t("code",[s._v("openjdk:8u212-jre")]),s._v("镜像，所以速度较慢，耐心等待即可，构建好后终端输出如下所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200129204734435.png",alt:"image-20200129204734435"}})]),s._v(" "),t("p",[s._v("查看当前镜像：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker images\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200129204825052.png",alt:"image-20200129204825052"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);