(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{585:function(t,e,a){"use strict";a.r(e);var s=a(26),o=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb数据库的备份、还原、导入及导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb数据库的备份、还原、导入及导出"}},[t._v("#")]),t._v(" MongoDB数据库的备份、还原、导入及导出")]),t._v(" "),a("h2",{attrs:{id:"_1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[t._v("#")]),t._v(" 1. 简介")]),t._v(" "),a("p",[t._v("MongoDB官方提供了两套数据导入导出工具，一般来说，")]),t._v(" "),a("ul",[a("li",[t._v("mongodump和mongorestore\n"),a("ul",[a("li",[t._v("进行整库导出导入时使用")]),t._v(" "),a("li",[t._v("操作的数据是BSON格式，进行大量dump和restore时效率较高。")])])]),t._v(" "),a("li",[t._v("mongoexport和mongoimport\n"),a("ul",[a("li",[t._v("进行单个集合导出导入时使用")]),t._v(" "),a("li",[t._v("操作的数据是JSON格式，可读性较高")])])])]),t._v(" "),a("h2",{attrs:{id:"_2-mongodump-备份-及mongorestore-还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-mongodump-备份-及mongorestore-还原"}},[t._v("#")]),t._v(" 2. mongodump（备份）及mongorestore（还原）")]),t._v(" "),a("h3",{attrs:{id:"_2-1-mongodump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mongodump"}},[t._v("#")]),t._v(" 2.1  mongodump")]),t._v(" "),a("h4",{attrs:{id:"_2-1-1-说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-说明"}},[t._v("#")]),t._v(" 2.1.1 说明")]),t._v(" "),a("p",[t._v("mongodump是一个用于导出二进制数据库内容的实用工具，它导出的bson文档中只会包含着集合文档等信息，不包括索引信息（索引信息会单独导出），所以还原后，索引必须重建（这个不用担心，使用mongorestore会自动重建mongodump生成的索引信息）。3.4版本中添加了对只读视图的支持。")]),t._v(" "),a("h4",{attrs:{id:"_2-1-2-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-参数"}},[t._v("#")]),t._v(" 2.1.2 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("命令")]),t._v(" "),a("th",[t._v("全称")]),t._v(" "),a("th",[t._v("默认值")]),t._v(" "),a("th",[t._v("参考释义")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td",[t._v("--help")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("查看mongodump命令的使用帮助")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("--version")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("返回mongodump的版本号")])]),t._v(" "),a("tr",[a("td",[t._v("-h")]),t._v(" "),a("td",[t._v("--host "),a("hostname",[t._v("<:port>")])],1),t._v(" "),a("td",[t._v("localhost:27017")]),t._v(" "),a("td",[t._v("指定mongod要连接的主机名及端口号")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("--port "),a("port")],1),t._v(" "),a("td",[t._v("27017")]),t._v(" "),a("td",[t._v("指定MongoDB实例监听客户连接的TCP端口号")])]),t._v(" "),a("tr",[a("td",[t._v("-u")]),t._v(" "),a("td",[t._v("--username "),a("username")],1),t._v(" "),a("td"),t._v(" "),a("td",[t._v("指定用于向使用认证的MongoDB数据库认证的用户名，与--password和 --authenticationDatabase结合使用")])]),t._v(" "),a("tr",[a("td",[t._v("-p")]),t._v(" "),a("td",[t._v("--password "),a("password")],1),t._v(" "),a("td"),t._v(" "),a("td",[t._v("指定用于向使用认证的MongoDB数据库认证的密码。与--username和 -- authenticationDatabase选项结合使用。")])]),t._v(" "),a("tr",[a("td",[t._v("-d")]),t._v(" "),a("td",[t._v("--db "),a("database")],1),t._v(" "),a("td"),t._v(" "),a("td",[t._v("指定要备份的数据库。如果不指定，mongodump会将此实例中的所有数据库备份。")])]),t._v(" "),a("tr",[a("td",[t._v("-c")]),t._v(" "),a("td",[t._v("--collection "),a("collection")],1),t._v(" "),a("td"),t._v(" "),a("td",[t._v("指定要备份的集合。如果不指定，则会将指定数据库或实例中的所有集合备份。")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("--gzip")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("3.2版本+，压缩输出，如果mongodump指定导出到目录，则该选项会将每个文件都压缩， 并添加.gz后缀； 如果mongodump指定导出到文档或标准输出流，则该选项会压缩到文档或输出流中")])]),t._v(" "),a("tr",[a("td",[t._v("-o")]),t._v(" "),a("td",[t._v("--out "),a("path")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("指定导出数据的目录路径，如不指定，则mongodump默认将文件输出到dump所在的工作目录中。 该选项不能和--archive一起使用")])])])]),t._v(" "),a("h4",{attrs:{id:"_2-1-3-举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-举例"}},[t._v("#")]),t._v(" 2.1.3 举例")]),t._v(" "),a("p",[t._v("将mytest数据库中的user集合导出到F:\\bk目录下(win在要bin目录下执行)")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("mongodump "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d mytest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("o F"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\bk\n")])])]),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210104143705063.png",alt:"image-20210104143705063"}})]),t._v(" "),a("p",[t._v("其中的metadata.json即为索引信息")]),t._v(" "),a("h3",{attrs:{id:"_2-2-mongorestore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-mongorestore"}},[t._v("#")]),t._v(" 2.2 mongorestore")]),t._v(" "),a("h4",{attrs:{id:"_2-2-1-说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-说明"}},[t._v("#")]),t._v(" 2.2.1 说明")]),t._v(" "),a("p",[t._v("mongorestore用来导入数据到MongoDB实例中，3.0.0版本以上支持通过标准输入流来导入数据。")]),t._v(" "),a("h4",{attrs:{id:"_2-2-2-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-参数"}},[t._v("#")]),t._v(" 2.2.2 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("全称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("参考释义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-d")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--db "),a("database")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要还原的数据库。如果不指定，restore将会还原dump记录的所有数据库，并会覆盖现有数据库数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-c")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--collection "),a("collection")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要还原的集合。如果不指定，mongorestore会从文件名中读取识别集合名称（如果有扩展名则会省略扩展名）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--drop")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("还原集合之前会先从目标数据库中删除集合，不会删除不在备份中的集合。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--gzip")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3.2版本+，从压缩文件中还原")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("path")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("要还原的数据文件路径，该参数必须是mongorestore命令的最后一个参数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--dir")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定备份文件目录")])])])]),t._v(" "),a("p",[t._v("其他参数与mongodump基本一致。")]),t._v(" "),a("h4",{attrs:{id:"_2-2-3-举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-举例"}},[t._v("#")]),t._v(" 2.2.3 举例：")]),t._v(" "),a("p",[t._v("通过user.bson文件还原mytest数据库中的user集合，并在还原之前进行删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mongorestore --drop -d mytest -c user --dir F:\\bk\\mytest\n")])])]),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("mongorestore "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--drop -d mytest -c user F:\\bk\\mytest\\user.bson")]),t._v("\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("linux下可以使用：mongorestore -d <db_name> <bson_folder>\nwindows下可以使用：mongorestore.exe -d <db_name> <bson_folder>\n")])])]),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210104143924453.png",alt:"image-20210104143924453"}})]),t._v(" "),a("h2",{attrs:{id:"_3-mongoexport-导出-及mongoimport-导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-mongoexport-导出-及mongoimport-导入"}},[t._v("#")]),t._v(" 3. mongoexport（导出）及mongoimport（导入）")]),t._v(" "),a("h3",{attrs:{id:"_3-1-mongoexport"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-mongoexport"}},[t._v("#")]),t._v(" 3.1 mongoexport")]),t._v(" "),a("h4",{attrs:{id:"_3-1-1-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-参数"}},[t._v("#")]),t._v(" 3.1.1 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("全称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("参考释义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--help")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看mongoexport的使用帮助")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--version")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看mongoexport的版本号")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-d")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--db "),a("database")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要在哪个数据库上运行该命令")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-c")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--collection "),a("collection")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要导出的集合")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-f")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--fields <field1[,field2]>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定导出时只导出一个或多个字段，导出多个时，需要使用逗号分隔; 当字段中有空格时，需要用英文引号括起来。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-q")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--query "),a("JSON")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("提供查询文档作为导出数据源")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--type"),a("string")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("json")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要导出的文件类型，可选值：json，csv")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-o")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("--out "),a("file")],1),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定要导出的文件路径（含文件名），如果不指定，则会导出为标准输出（例如stdout）")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-1-2-举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-举例"}},[t._v("#")]),t._v(" 3.1.2 举例")]),t._v(" "),a("p",[t._v("导出mytest数据库中的user集合到user.json文件中")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("D"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\tool\\mongodb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\\bin\\mongoexport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("collection myCollection "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("db myDB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("o D"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\data\\myCollection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n")])])]),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210104144117228.png",alt:"image-20210104144117228"}})]),t._v(" "),a("h3",{attrs:{id:"_3-2-mongoimport"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-mongoimport"}},[t._v("#")]),t._v(" 3.2 mongoimport")]),t._v(" "),a("h4",{attrs:{id:"_3-2-1-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-参数"}},[t._v("#")]),t._v(" 3.2.1 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("可选值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("参考释义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--ignoreBlanks")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("忽略要导入文件中的空字段，如果不指定该参数，则默认会读取空字段并创建")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--type <json|csv|tsv>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("json，csv，tsv")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("要导入的文件类型，另外支持tsv")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--headerline")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("使用第一行作为字段名称")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--mode <insert|upsert|merge>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("insert（插入）， upsert（替换数据库中的文档）， merge（合并）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定导入过程中，如何应对数据库文档与导入文件中的文档匹配 （默认会使用_id字段对比）的情况")])])])]),t._v(" "),a("p",[t._v("其他参数与mongoexport基本一致")]),t._v(" "),a("h4",{attrs:{id:"_3-2-2-举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-举例"}},[t._v("#")]),t._v(" 3.2.2 举例")]),t._v(" "),a("p",[t._v("从user.json文件导入到mytest数据库中的user集合，并在之前进行删除")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("mongoimport "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--drop -d mytest -c user --file F:\\bk\\user.json")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20210104144243185.png",alt:"image-20210104144243185"}})]),t._v(" "),a("h2",{attrs:{id:"_4-mongoexport-mongoimport与mongodump-mongorestore的对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-mongoexport-mongoimport与mongodump-mongorestore的对比"}},[t._v("#")]),t._v(" 4. mongoexport/mongoimport与mongodump/mongorestore的对比")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("mongoexport/mongoimport导入/导出的是JSON格式，而mongodump/mongorestore导入/导出的是BSON格式。")]),t._v(" "),a("li",[t._v("JSON可读性强但体积较大，BSON则是二进制文件，体积小但对人类几乎没有可读性。")]),t._v(" "),a("li",[t._v("在一些mongodb版本之间，BSON格式可能会随版本不同而有所不同，所以不同版本之间用mongodump/mongorestore可能不会成功，具体要看版本之间的兼容性。当无法使用BSON进行跨版本的数据迁移的时候，使用JSON格式即mongoexport/mongoimport是一个可选项。跨版本的mongodump/mongorestore并不推荐，实在要做请先检查文档看两个版本是否兼容（大部分时候是的）。")]),t._v(" "),a("li",[t._v("JSON虽然具有较好的跨版本通用性，但其只保留了数据部分，不保留索引，账户等其他基础信息。使用时应该注意。")])])]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/qq_16313365/article/details/56494522",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB学习（六）数据库的备份、还原、导入及导出"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000012330284",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker MongoDB 数据库备份 并复制到宿主 恢复"),a("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=o.exports}}]);