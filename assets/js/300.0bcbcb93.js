(window.webpackJsonp=window.webpackJsonp||[]).push([[300],{675:function(a,s,t){"use strict";t.r(s);var e=t(26),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"flyway-commandline使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flyway-commandline使用"}},[a._v("#")]),a._v(" Flyway-commandline使用")]),a._v(" "),t("h2",{attrs:{id:"_1-flyway下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-flyway下载"}},[a._v("#")]),a._v(" 1. flyway下载")]),a._v(" "),t("p",[a._v("https://repo1.maven.org/maven2/org/flywaydb/")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211011213319190.png",alt:"image-20211011213319190"}})]),a._v(" "),t("ul",[t("li",[a._v("conf ：存放flyway.conf配置文件，通过jdbc方式配置数据库连接")]),a._v(" "),t("li",[a._v("drivers：存放数据库jdbc驱动")]),a._v(" "),t("li",[a._v("sql：存放数据库元数据sql脚本")])]),a._v(" "),t("h2",{attrs:{id:"_2-配置conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置conf"}},[a._v("#")]),a._v(" 2. 配置conf")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 数据库url地址")]),a._v("\nflyway.url"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("jdbc:mysql://192.168.0.1:3306/flywaytest?useUnicode"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("characterEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf8"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zeroDateTimeBehavior")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("convertToNull"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("useSSL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("serverTimezone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("GMT%2B8\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 数据库驱动")]),a._v("\nflyway.driver"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.mysql.jdbc.Driver\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据库用户名")]),a._v("\nflyway.user"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据库密码")]),a._v("\nflyway.password"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("youpassword\n")])])]),t("h2",{attrs:{id:"_3-新建初始化sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-新建初始化sql"}},[a._v("#")]),a._v(" 3. 新建初始化sql")]),a._v(" "),t("p",[a._v("V1001__Create_person_table.sql")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("create")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),a._v(" PERSON "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    ID "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("not")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    NAME "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("not")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("null")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h2",{attrs:{id:"_4-初始化版本控制表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-初始化版本控制表"}},[a._v("#")]),a._v(" 4. 初始化版本控制表")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./flyway migrate -baselineOnMigrate"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211011214740961.png",alt:"image-20211011214740961"}})]),a._v(" "),t("h2",{attrs:{id:"_5-flyway-常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-flyway-常用命令"}},[a._v("#")]),a._v(" 5. Flyway 常用命令")]),a._v(" "),t("h3",{attrs:{id:"_5-1-migrate命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-migrate命令"}},[a._v("#")]),a._v(" 5.1 Migrate命令")]),a._v(" "),t("p",[a._v("执行sql文件夹中未执行的sql，将sql版本更到最新。如果Flyway不存在，它将自动创建架构历史记录表。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026152909198.png",alt:"image-20211026152909198"}})]),a._v(" "),t("h4",{attrs:{id:"_5-1-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-使用"}},[a._v("#")]),a._v(" 5.1.1 使用")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("flyway  migrate\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026154955580.png",alt:"image-20211026154955580"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026154919444.png",alt:"image-20211026154919444"}})]),a._v(" "),t("h3",{attrs:{id:"_5-2-clean-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-clean-命令"}},[a._v("#")]),a._v(" 5.2 clean 命令")]),a._v(" "),t("p",[a._v("删除已配置模式中的所有对象（表，视图，过程，触发器等）。\n架构将按照"),t("code",[a._v("schemas")]),a._v("属性指定的顺序进行清理。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026153049436.png",alt:"image-20211026153049436"}})]),a._v(" "),t("h4",{attrs:{id:"_5-2-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-使用"}},[a._v("#")]),a._v(" 5.2.1 使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("flyway  clean\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026155035705.png",alt:"image-20211026155035705"}})]),a._v(" "),t("p",[a._v("表已经被清空了")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026155129127.png",alt:"image-20211026155129127"}})]),a._v(" "),t("h3",{attrs:{id:"_5-3-info命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-info命令"}},[a._v("#")]),a._v(" 5.3 info命令")]),a._v(" "),t("p",[a._v("打印有关所有迁移的详细信息和状态信息。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026153221574.png",alt:"image-20211026153221574"}})]),a._v(" "),t("h4",{attrs:{id:"_5-3-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-使用"}},[a._v("#")]),a._v(" 5.3.1 使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("flyway  info\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026155748244.png",alt:"image-20211026155748244"}})]),a._v(" "),t("p",[a._v("相比数据库这张表")]),a._v(" "),t("ul",[t("li",[a._v("数据列会更少一些。比如执行者、执行时间")]),a._v(" "),t("li",[a._v("但是这里会出现待执行的")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026155329057.png",alt:"image-20211026155329057"}})]),a._v(" "),t("h3",{attrs:{id:"_5-4-validate-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-validate-命令"}},[a._v("#")]),a._v(" 5.4 validate 命令")]),a._v(" "),t("p",[a._v("针对已解决的迁移（在文件系统或类路径上）验证已应用的迁移，以检测可能会导致无法准确创建模式的意外更改。")]),a._v(" "),t("p",[a._v("如果验证失败")]),a._v(" "),t("ul",[t("li",[a._v("发现迁移名称，类型或校验和方面的差异")]),a._v(" "),t("li",[a._v("已应用不再在本地解析的版本")]),a._v(" "),t("li",[a._v("已解决尚未应用的版本")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026153524052.png",alt:"image-20211026153524052"}})]),a._v(" "),t("h4",{attrs:{id:"_5-4-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-使用"}},[a._v("#")]),a._v(" 5.4.1 使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("flyway  validate\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026160024340.png",alt:"image-20211026160024340"}})]),a._v(" "),t("p",[a._v("原有的脚本如果变化了，用这个就可以校验是哪个脚本")]),a._v(" "),t("p",[a._v("改回原来的就没有问题了")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026160110913.png",alt:"image-20211026160110913"}})]),a._v(" "),t("h3",{attrs:{id:"_5-5-baseline-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-baseline-命令"}},[a._v("#")]),a._v(" 5.5 baseline 命令")]),a._v(" "),t("p",[a._v("为现有数据库提供基准，不包括直到包括的所有迁移"),t("code",[a._v("baselineVersion")]),a._v("。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026153926959.png",alt:"image-20211026153926959"}})]),a._v(" "),t("h4",{attrs:{id:"_5-5-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-使用"}},[a._v("#")]),a._v(" 5.5.1 使用")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("flyway  baseline\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026160250111.png",alt:"image-20211026160250111"}})]),a._v(" "),t("p",[a._v("如果数据库中有数据会报错，需要clean清空数据后，在执行")]),a._v(" "),t("h3",{attrs:{id:"_5-6-repair-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-repair-命令"}},[a._v("#")]),a._v(" 5.6 repair 命令")]),a._v(" "),t("p",[a._v("修复Flyway模式历史记录表。这将执行以下操作：")]),a._v(" "),t("ul",[t("li",[a._v("在没有DDL事务的数据库上删除所有失败的迁移\n（仍然必须手动清理留下的用户对象）")]),a._v(" "),t("li",[a._v("将可用迁移的校验和，描述和类型与可用迁移重新对齐")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026154058239.png",alt:"image-20211026154058239"}})]),a._v(" "),t("h4",{attrs:{id:"_5-6-1-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-1-使用"}},[a._v("#")]),a._v(" 5.6.1 使用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("flyway repair\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20211026160918822.png",alt:"image-20211026160918822"}})]),a._v(" "),t("p",[a._v("对有报错的语句执行后会回滚。")]),a._v(" "),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/u012045045/article/details/106312789",target:"_blank",rel:"noopener noreferrer"}},[a._v("Flyway自学之路-03（几个可用命令行操作Flyway）"),t("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);