(window.webpackJsonp=window.webpackJsonp||[]).push([[919],{1295:function(t,s,n){"use strict";n.r(s);var a=n(26),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"jenkins使用jenkinsfile部署前端vue项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins使用jenkinsfile部署前端vue项目"}},[t._v("#")]),t._v(" Jenkins使用jenkinsfile部署前端Vue项目")]),t._v(" "),n("h2",{attrs:{id:"_1-背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-背景"}},[t._v("#")]),t._v(" 1. 背景")]),t._v(" "),n("p",[t._v("jenkinsfile的文件通用性更强，可以方便的复制到各个项目")]),t._v(" "),n("h2",{attrs:{id:"_2-创建任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建任务"}},[t._v("#")]),t._v(" 2. 创建任务")]),t._v(" "),n("p",[t._v("创建的时候选择：流水线")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210919194741168.png",alt:"image-20210919194741168"}})]),t._v(" "),n("h2",{attrs:{id:"_3-部署文件jenkinsfile代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-部署文件jenkinsfile代码"}},[t._v("#")]),t._v(" 3. 部署文件jenkinsfile代码")]),t._v(" "),n("p",[t._v("在项目根目录下建：jenkinsfile文件")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!groovy")]),t._v("\n\n@Library"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jenkinslib'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" _\n\ndef color "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new org.devops.color"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndef build "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new org.devops.build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndef deploy "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new org.devops.deploy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndef systemtime "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new org.devops.systemtime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndef String isDeploy "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${env.isDeploy}")]),t._v('"')]),t._v("\n//目标服务器ip和路径，根据实际情况修改\ndef String serverIp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.0.1'")]),t._v("\ndef String targetPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/home/myproject'")]),t._v("\n\n//部署包的简称，根据实际情况修改\ndef artifactShortName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MY_WEB'")]),t._v("\ndef String releaseVersion "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${env.releaseVersion}")]),t._v('"')]),t._v("\n\npipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        node "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            label "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    options "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        buildDiscarder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logRotator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("numToKeepStr: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n        disableConcurrentBuilds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    triggers "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'H 22 * * *'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    parameters "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        string defaultValue: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.10.0'")]),t._v(", description: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请输入本次构建的前三段版本号'")]),t._v(", name: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'releaseVersion'")]),t._v(", trim: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        choice choices: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'否'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", description: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是否要发布到服务器，默认发布'")]),t._v(", name: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'isDeploy'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            NODE_HOME "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/node"')]),t._v("\n            SASS_BINARY_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/linux-x64-72_binding.node"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SASS_BINARY_PATH")]),t._v("/bin:"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v(":"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NODE_HOME")]),t._v('/bin"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Mvn Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("'npm "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" node-sass\n            \t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n            \t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#npm run build")]),t._v("\n                                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build:prod"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\n                        }\n\n        }\n         stage('")]),t._v("archive"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("') {\n                    steps {\n                        script {\n                            color.PrintMes('")]),t._v("开始压缩"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),t._v("green"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("')\n                            currentTime = systemtime.GetSysTime('")]),t._v("yyMMdd"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\')\n                            //部署包是jar还是war，以及路径要根据实际情况修改d\n                            sh """ rm -rf archive"""\n                            sh """ rm -rf *.tar.gz"""\n                            sh """ mkdir archive """\n                            sh """ tar -zcvf my_web.tar.gz bj_web """\n                            sh """ cp -r my_web archive """\n                            sh """ cp doc/版本更新说明.md archive """\n                            sh """ rm -rf my_web """\n                            sh """ tar -zcvf '),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${artifactShortName}")]),t._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${releaseVersion}")]),t._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${env.GIT_COMMIT.take(8)}")]),t._v("-BETA-"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${currentTime}")]),t._v('.tar.gz archive """\n                            //根据实际情况修改制品路径和名称，这个是用来把包提取到jenkins页面，给测试下载的\n                            archiveArtifacts \'')]),t._v("*.tar.gz"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\n                            currentBuild.description = \"Start By "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${env.BUILD_USER}")]),t._v(" And Build Success\"\n\n                        }\n                    }\n                }\n        stage('")]),t._v("Deploy App"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("') {\n            when {\n                expression {\n                    return (isDeploy == '")]),t._v("是"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("')\n                }\n            }\n            steps {\n                script {\n                    color.PrintMes('")]),t._v("自动发布"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),t._v("green"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\')\n                    deployCommand = """cd /faduit/zfba/ && rm -rf my_web && tar zxvf my_web.tar.gz """\n                    deploy.Publish(serverIp, deployCommand, targetPath, \'')]),t._v("my_web.tar.gz"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),t._v("'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);