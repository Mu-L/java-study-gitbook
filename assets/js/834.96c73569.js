(window.webpackJsonp=window.webpackJsonp||[]).push([[834],{1209:function(a,s,t){"use strict";t.r(s);var e=t(26),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"redis从海量数据里查询某一固定前缀的key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis从海量数据里查询某一固定前缀的key"}},[a._v("#")]),a._v(" Redis从海量数据里查询某一固定前缀的key")]),a._v(" "),t("h2",{attrs:{id:"_1-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[a._v("#")]),a._v(" 1. 简介")]),a._v(" "),t("p",[a._v("主要有两种方法")]),a._v(" "),t("ul",[t("li",[a._v("keys pattern：查找所有符合给定模式pattern")]),a._v(" "),t("li",[a._v("Scan：Scan cursor [match pattern] [COUNT count]")])]),a._v(" "),t("h2",{attrs:{id:"_2-批量生成redis测试数据方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-批量生成redis测试数据方法"}},[a._v("#")]),a._v(" 2.批量生成redis测试数据方法")]),a._v(" "),t("p",[t("a",{attrs:{href:"../action/%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90redis%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%96%B9%E6%B3%95"}},[a._v("参考文章-批量生成redis测试数据方法")])]),a._v(" "),t("h2",{attrs:{id:"_3-查询某一固定前缀的key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-查询某一固定前缀的key"}},[a._v("#")]),a._v(" 3. 查询某一固定前缀的key")]),a._v(" "),t("h3",{attrs:{id:"_3-1-方案一-keys-pattern"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-方案一-keys-pattern"}},[a._v("#")]),a._v(" 3.1 方案一：keys pattern")]),a._v(" "),t("p",[a._v("keys pattern：查找所有符合给定模式pattern")]),a._v(" "),t("p",[a._v("缺点：使用keys 会对上线业务有影响")]),a._v(" "),t("ul",[t("li",[a._v("keys 指定一次性返回所有匹配的key")]),a._v(" "),t("li",[a._v("键的数量过大会使服务卡顿")])]),a._v(" "),t("h4",{attrs:{id:"_3-1-1-实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-实战"}},[a._v("#")]),a._v(" 3.1.1 实战")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("查看当前redis数据库的数据量")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("dbsize\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210410112532695.png",alt:"image-20210410112532695"}})])]),a._v(" "),t("li",[t("p",[a._v("匹配测试")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(" keys k1*\n")])])]),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210410112503140.png",alt:"image-20210410112503140"}})]),a._v(" "),t("p",[a._v("我们可以看到需要花费85才查询完")])])]),a._v(" "),t("h3",{attrs:{id:"_3-2-使用-scan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用-scan"}},[a._v("#")]),a._v(" 3.2 使用 Scan")]),a._v(" "),t("h4",{attrs:{id:"_3-2-1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-语法"}},[a._v("#")]),a._v(" 3.2.1 语法")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("scan cursor [match pattern] [COUNT count]\n")])])]),t("h4",{attrs:{id:"_3-2-2-scan-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-scan-介绍"}},[a._v("#")]),a._v(" 3.2.2 scan 介绍")]),a._v(" "),t("ul",[t("li",[a._v("基于游标的迭代器，需要基于上一次的游标延续之前的迭代过程")]),a._v(" "),t("li",[a._v("以0作为游标开始一次新的迭代，直到命令返回游标0完成一次遍历")]),a._v(" "),t("li",[a._v("不保证每次执行都返回某个给定数量的元素，支持模糊查询")]),a._v(" "),t("li",[a._v("一次返回的数量不可控，只能是大概率符合count 参数")])]),a._v(" "),t("h4",{attrs:{id:"_3-2-3-实战示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-实战示例"}},[a._v("#")]),a._v(" 3.2.3 实战示例")]),a._v(" "),t("p",[a._v("我们使用scan查询")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210410112658763.png",alt:"image-20210410112658763"}})]),a._v(" "),t("p",[a._v("我们返回的第一个是游标，第二个是结果。结果并不一定满足count")]),a._v(" "),t("p",[a._v("我们通过游标继续查找")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210410112902489.png",alt:"image-20210410112902489"}})]),a._v(" "),t("h4",{attrs:{id:"_3-2-4-tips"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-tips"}},[a._v("#")]),a._v(" 3.2.4 tips")]),a._v(" "),t("ul",[t("li",[a._v("游标的大小不是固定的，非递增或递减")]),a._v(" "),t("li",[a._v("count 指定返回数据量不是一定的，只是大体符合")]),a._v(" "),t("li",[a._v("scan命令获取到的key 有可能重复，可以利用java的set去重")])]),a._v(" "),t("h4",{attrs:{id:"_3-2-5-rmd客户端也使用scan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-rmd客户端也使用scan"}},[a._v("#")]),a._v(" 3.2.5 rmd客户端也使用scan")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/image-20210410104006086.png",alt:"image-20210410104006086"}})]),a._v(" "),t("h2",{attrs:{id:"_4-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-总结"}},[a._v("#")]),a._v(" 4. 总结")]),a._v(" "),t("p",[a._v("从海量的key里面查询出某一固定前缀的key的时候")]),a._v(" "),t("ol",[t("li",[a._v("要注意数据量")]),a._v(" "),t("li",[a._v("在使用keys命令的时候会一次性返回所有的keys会造成卡顿")]),a._v(" "),t("li",[a._v("使用scan命令的时候要注意去重和获取上一次的游标")])]),a._v(" "),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://www.jianshu.com/p/19f813af8f64",target:"_blank",rel:"noopener noreferrer"}},[a._v("redis从海量的key里面查询出某一固定前缀的key"),t("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);