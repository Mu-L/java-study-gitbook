(window.webpackJsonp=window.webpackJsonp||[]).push([[537],{913:function(t,s,a){"use strict";a.r(s);var n=a(26),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"minioserver启动模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minioserver启动模式"}},[t._v("#")]),t._v(" MinioServer启动模式")]),t._v(" "),a("h2",{attrs:{id:"_1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[t._v("#")]),t._v(" 1. 简介")]),t._v(" "),a("p",[t._v("minio支持多种server启动模式：")]),t._v(" "),a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715171521129.png",alt:"image-20220715171521129"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("standalone模式")]),t._v(" "),a("p",[t._v("即要管理的磁盘都在host本地。该启动模式一般仅用于实验环境、测试环境的验证和学习使用。在standalone模式下，还可以分为")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("non-erasure code mode")])]),t._v(" "),a("li",[a("strong",[t._v("erasure code mode")]),t._v("。")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-1-standalone-之-non-erasure-code-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-standalone-之-non-erasure-code-模式"}},[t._v("#")]),t._v(" 1.1 standalone 之 non-erasure code 模式")]),t._v(" "),a("p",[t._v("所谓"),a("strong",[t._v("non-erasure code mode")]),t._v("，即minio server启动时仅传入一个本地磁盘目录参数：比如：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server data\n\nEndpoint:  http://10.10.126.88:9000  http://127.0.0.1:9000\nAccessKey: minioadmin\nSecretKey: minioadmin\n\nBrowser Access:\n   http://10.10.126.88:9000  http://127.0.0.1:9000           \n\nCommand-line Access: https://docs.min.io/docs/minio-client-quickstart-guide\n   $ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mc")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" myminio http://10.10.126.88:9000 minioadmin minioadmin\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n")])])]),a("p",[t._v("在这样的启动模式下，对于每一份对象数据，minio直接在data下面存储这份数据，不会建立副本，也不会启用纠删码机制。因此，"),a("strong",[t._v("这种模式无论是服务实例还是磁盘都是“单点”，无任何高可用保障，磁盘损坏就表示数据丢失。")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-standalone-之-non-erasure-code-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-standalone-之-non-erasure-code-模式"}},[t._v("#")]),t._v(" 1.2 standalone 之 non-erasure code 模式")]),t._v(" "),a("p",[t._v("erasure code mode即为minio server"),a("strong",[t._v("实例传入多个本地磁盘参数")]),t._v("。一旦遇到多于一个磁盘参数，minio server会自动启用"),a("strong",[t._v("erasure code mode")]),t._v("。"),a("strong",[t._v("erasure code")]),t._v("对磁盘的个数是有要求的（最少4个），如不满足要求，实例启动将失败：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server data1 data2\nERROR Invalid "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" line arguments: Incorrect number of endpoints provided "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("data1 data2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Please provide an even number of endpoints greater or equal to "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n      HINT:\n        For "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" information, please refer to https://docs.min.io/docs/minio-erasure-code-quickstart-guide\n")])])]),a("p",[a("strong",[t._v("erasure code")]),t._v("启用后，要求传给minio server的endpoint(standalone模式下，即本地磁盘上的目录)"),a("a",{attrs:{href:"https://docs.minio.io/docs/minio-erasure-code-quickstart-guide.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("至少为4个"),a("OutboundLink")],1),t._v("。minio server启用纠删码机制后，会自动将传入的disk drive划分为多个"),a("strong",[t._v("erasure coding set")]),t._v("，每个"),a("strong",[t._v("erasure coding set")]),t._v("中的disk drive的数量可以是：4, 6, 8, 10, 12, 14 和16。minio server会根据传入disk drive的数量自动计算set个数和每个set中的disk drive数量。比如下面例子中，我们传入四个endpoint(disk drive)给minio server：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server data1 data2 data3 data4\n\nFormatting "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" zone, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" drives per set.\nWARNING: Host "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" has "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" than "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" drives of set. A "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" failure will result "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" data becoming unavailable.\nStatus:         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" Online, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Offline.\nEndpoint:  http://10.10.126.88:9000  http://127.0.0.1:9000\nAccessKey: minioadmin\nSecretKey: minioadmin\n\nBrowser Access:\n   http://10.10.126.88:9000  http://127.0.0.1:9000           \n\nCommand-line Access: https://docs.min.io/docs/minio-client-quickstart-guide\n   $ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mc")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" myminio http://10.10.126.88:9000 minioadmin minioadmin\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n")])])]),a("p",[t._v("从minio server的输出日志来看，minio server将这些drive放入了一个"),a("strong",[t._v("erasure coding set")]),t._v("了。在输出日志中，我们还看到一行WARNING: "),a("strong",[t._v("Host local has more than 2 drives of set. A host failure will result in data becoming unavailable.")]),t._v("，即minio server警告我们：这个"),a("strong",[t._v("erasure coding set")]),t._v("中有多于两个的drive都在local host上，这样一旦host宕机，那么数据将无法获取。(每个set 有4个drive，根据纠删码的机制，这个set的最大允许失效的disk数量为4/2=2)。")]),t._v(" "),a("h4",{attrs:{id:"_1-2-1-语法糖-省略号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-语法糖-省略号"}},[t._v("#")]),t._v(" 1.2.1 语法糖-省略号")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nFormatting "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" zone, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" drives per set.\nWARNING: Host "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" has "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" than "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" drives of set. A "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" failure will result "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" data becoming unavailable.\nWARNING: Host "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" has "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" than "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" drives of set. A "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" failure will result "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" data becoming unavailable.\nWARNING: Host "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" has "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" than "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" drives of set. A "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" failure will result "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" data becoming unavailable.\nStatus:         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" Online, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Offline.\nEndpoint:  http://10.10.126.88:9000  http://127.0.0.1:9000\nAccessKey: minioadmin\nSecretKey: minioadmin\n\nBrowser Access:\n   http://10.10.126.88:9000  http://127.0.0.1:9000           \n\nCommand-line Access: https://docs.min.io/docs/minio-client-quickstart-guide\n   $ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mc")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" myminio http://10.10.126.88:9000 minioadmin minioadmin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("minio server data{1...18}\n")])])]),a("p",[t._v("等价于")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("minio server data1 data2 data3 data4 data5 data6 data7 data8 data9 data10 data11 data 12 data13 data14 data15 data16 data17 data18\n")])])]),a("p",[t._v("minio server会自行扩展省略号代表的内容。我们看到：当我们传入18个disk drive后，minio server创建了3个"),a("strong",[t._v("erasure coding set")]),t._v("，每个set中有6个disk drive。同样，minio server还针对每个set输出了一行WARNING：每个Set中有三个以上的disk drive都位于同一台host上。")]),t._v(" "),a("p",[t._v("这些WARNING我们可以通过distributed mode来解决。顾名思义，distributed mode下，minio server实例和其管理的disk drive分布在多台host上，这种模式可以避免minio server实例单点，数据也将分布在不同host上的不同disk中，实现了高可用，提升了整体的容灾能力。由于处理多个host上的disk，distribute mode默认就会启动"),a("strong",[t._v("erasure coding set")]),t._v("机制。")]),t._v(" "),a("h3",{attrs:{id:"_1-3-distributed-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-distributed-mode"}},[t._v("#")]),t._v(" 1.3 distributed mode")]),t._v(" "),a("p",[t._v("在distributed mode下，minio server后面的远程的endpoint采用http url编码格式：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MINIO_ACCESS_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ACCESS_KEY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MINIO_SECRET_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SECRET_KEY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server http://host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":9000/minio/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("上面例子中的minio server命令相当于4个host，每个host上启动一个minio server实例，每个实例都管理16的disk drive(包括本地和远程的)。上述命令等价于：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$minio")]),t._v(" server http://host1:9000/minio/data1 http://host1:9000/minio/data2 http://host1:9000/minio/data3 http://host1:9000/minio/data4 http://host2:9000/minio/data1 http://host2:9000/minio/data2 http://host2:9000/minio/data3 http://host2:9000/minio/data4 http://host3:9000/minio/data1 http://host3:9000/minio/data2 http://host3:9000/minio/data3 http://host3:9000/minio/data4 http://host4:9000/minio/data1 http://host4:9000/minio/data2 http://host4:9000/minio/data3 http://host4:9000/minio/data4\n")])])]),a("p",[t._v("minio同样会自动将这些disk drive划分为若干个"),a("strong",[t._v("erasure coding set")]),t._v("。每个endpoint用"),a("code",[t._v("http://address/disk-drive-path")]),t._v("的形式编码。注意："),a("code",[t._v("这条命令在host1、host2、host3和host4上都要执行")])]),t._v(" "),a("h2",{attrs:{id:"_2-zone的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-zone的概念"}},[t._v("#")]),t._v(" 2. "),a("code",[t._v("zone")]),t._v("的概念")]),t._v(" "),a("p",[t._v("比如下面这个例子：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$minio server data{1...8} data{9...16}\n\nFormatting 1 zone, 1 set(s), 8 drives per set.\nWARNING: Host local has more than 4 drives of set. A host failure will result in data becoming unavailable.\nFormatting 2 zone, 1 set(s), 8 drives per set.\nWARNING: Host local has more than 4 drives of set. A host failure will result in data becoming unavailable.\nStatus:         16 Online, 0 Offline.\nEndpoint:  http://10.10.126.88:9000  http://127.0.0.1:9000\nAccessKey: minioadmin\nSecretKey: minioadmin\n\nBrowser Access:\n   http://10.10.126.88:9000  http://127.0.0.1:9000           \n\nCommand-line Access: https://docs.min.io/docs/minio-client-quickstart-guide\n   $ mc config host add myminio http://10.10.126.88:9000 minioadmin minioadmin\n\n... ...\n")])])]),a("p",[t._v("我们在命令行中给minio server传入两组采用“省略号”语法的参数，minio认为"),a("strong",[t._v("每组")]),t._v("就是一个**“zone”"),a("strong",[t._v("，这里有两组，因此minio创建了两个")]),t._v("zone**。在每个zone内，minio创建了一个"),a("strong",[t._v("erasure coding set")]),t._v("，每个set中有8个disk drive。对于外部的写数据请求，minio server会首先查找可用空间多的zone，然后再在zone内选择set和disk drive。")]),t._v(" "),a("p",[t._v("如果不用“省略号”语法，那么minio server会将后面传入的所有disk drive放入一个zone中")]),t._v(" "),a("h2",{attrs:{id:"_3-部署distributed-minio集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-部署distributed-minio集群"}},[t._v("#")]),t._v(" 3. 部署distributed minio集群")]),t._v(" "),a("h3",{attrs:{id:"_3-1-单机上部署distributed-minio集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-单机上部署distributed-minio集群"}},[t._v("#")]),t._v(" 3. 1. 单机上部署distributed minio集群")]),t._v(" "),a("p",[t._v("我们的验证环境采用最小的distributed minio模式：单机、one zone, one erasure coding set, 4 disk drive。下面是部署的示意图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715200417201.png",alt:"image-20220715200417201"}})]),t._v(" "),a("p",[t._v("我们没有使用“省略号”语法，在单机上不是很好模拟。我们通过下面脚本来启动该minio集群：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat startup_minio.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MINIO_ACCESS_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"minio"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MINIO_SECRET_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"minio123"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[t._v("i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("04"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" minio server --address "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":90'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${i}")]),t._v('"')]),t._v(" http://127.0.0.1:9001/root/minio-install/data1 http://127.0.0.1:9002/root/minio-install/data2  http://127.0.0.1:9003/root/minio-install/data3 http://127.0.0.1:9004/root/minio-install/data4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/root/minio-install/90'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${i}")]),t._v('.log"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])])]),a("p",[t._v("启动该minio集群，并查看启动状态：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bash startup_minio.sh")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ps -ef|grep minio")]),t._v("\n\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1218")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":58 pts/5    00:00:01 minio server --address :9001 http://127.0.0.1:9001/root/minio-install/data1 http://127.0.0.1:9002/root/minio-install/data2 http://127.0.0.1:9003/root/minio-install/data3 http://127.0.0.1:9004/root/minio-install/data4\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1219")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":58 pts/5    00:00:01 minio server --address :9002 http://127.0.0.1:9001/root/minio-install/data1 http://127.0.0.1:9002/root/minio-install/data2 http://127.0.0.1:9003/root/minio-install/data3 http://127.0.0.1:9004/root/minio-install/data4\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1220")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":58 pts/5    00:00:00 minio server --address :9003 http://127.0.0.1:9001/root/minio-install/data1 http://127.0.0.1:9002/root/minio-install/data2 http://127.0.0.1:9003/root/minio-install/data3 http://127.0.0.1:9004/root/minio-install/data4\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1221")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":58 pts/5    00:00:01 minio server --address :9004 http://127.0.0.1:9001/root/minio-install/data1 http://127.0.0.1:9002/root/minio-install/data2 http://127.0.0.1:9003/root/minio-install/data3 http://127.0.0.1:9004/root/minio-install/data4\n\nroot@instance-cspzrq3u:~/minio-install"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),t._v(".log  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9002")]),t._v(".log  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9003")]),t._v(".log  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9004")]),t._v(".log  data1  data2  data3  data4  startup_minio.sh\nroot@instance-cspzrq3u:~/minio-install"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tail -100f 9001.log")]),t._v("\n\nFormatting "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" zone, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" drives per set.\nAttempting encryption of all config, IAM "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v(" and policies on MinIO backend\nStatus:         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" Online, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Offline.\nEndpoint:  http://192.168.16.4:9001  http://172.17.0.1:9001  http://172.18.0.1:9001  http://127.0.0.1:9001       \n\nBrowser Access:\n   http://192.168.16.4:9001  http://172.17.0.1:9001  http://172.18.0.1:9001  http://127.0.0.1:9001       \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("h3",{attrs:{id:"_3-2-mc配置与管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-mc配置与管理"}},[t._v("#")]),t._v(" 3.2 mc配置与管理")]),t._v(" "),a("p",[t._v("minio官方提供了mc命令行工具，用于对minio server进行管理。我们首先要为mc创建一个管理本地minio server(:9001)的配置：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# mc config host add myminio \n")])])]),a("p",[t._v("这里我们使用mc添加了一个所谓”host”，指向上面创建的minio server(:9001)。上面的命令实质上是在~/.mc/config.json中写入了如下配置：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("# cat ~/.mc/config.json\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"myminio"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9001"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"accessKey"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"minio"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"secretKey"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"minio123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"api"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3v4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lookup"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("接下来，我们通过mc命令在minio集群中添加三个bucket：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc mb myminio/image")]),t._v("\nBucket created successfully "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/image"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nroot@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc mb myminio/video")]),t._v("\nBucket created successfully "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/video"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nroot@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc mb myminio/audio")]),t._v("\nBucket created successfully "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/audio"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nroot@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc ls myminio")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-03-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":19:55 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("      0B audio/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-03-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":19:48 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("      0B image/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-03-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":19:52 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("      0B video/\n")])])]),a("p",[t._v("新创建的bucket默认的访问policy是none，即外部无访问权限：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc policy get myminio/image")]),t._v("\nAccess permission "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/image"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" is "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n")])])]),a("p",[t._v("根据我们的设计，我们需要给这三个bucket添加外部可读取权限，以image这个bucket为例：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc policy set download myminio/image")]),t._v("\nAccess permission "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/image"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" is "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" to "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("download"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\nroot@instance-cspzrq3u:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mc policy get myminio/image")]),t._v("\nAccess permission "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("myminio/image"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" is "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("download"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-3-load-balancer设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-load-balancer设置"}},[t._v("#")]),t._v(" 3.3. load balancer设置")]),t._v(" "),a("p",[t._v("这里我们使用一个nginx前置在minio集群外部，下面是为minio创建的nginx配置文件(/etc/nginx/conf.d/minio.conf)：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("minio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" minio_cluster "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9002")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9003")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9004")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" myminio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tonybai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# To allow special characters in headers")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ignore_invalid_headers")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow any size file to be uploaded.")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set to a value such as 1000m; to restrict file size to a specific value")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# To disable buffering")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffering")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default is HTTP/1, keepalive is only enabled in HTTP/1.1")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_http_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("chunked_transfer_encoding")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("minio_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default is HTTP/1, keepalive is only enabled in HTTP/1.1")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_http_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("chunked_transfer_encoding")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffering")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("minio_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("重启nginx（nginx -s reload)。")]),t._v(" "),a("p",[t._v("我们使用浏览器访问一下"),a("code",[t._v("http://myminio.tonybai.com:9000/")]),t._v("，登录后，你将看到如下页面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715200904574.png",alt:"image-20220715200904574"}})]),t._v(" "),a("p",[t._v("选择左侧的”image” bucket，点击右下角的”+”号，我们可以上传一张图片：gopher-daily-logo.png，上传后，我们退出登录。然后通过地址"),a("code",[t._v("http://myminio.tonybai.com:9000/image/gopher-daily-logo.png")]),t._v("访问该图片。你也可以通过wget命令下载该图片：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$wget")]),t._v(" -c http://myminio.tonybai.com:9000/image/gopher-daily-logo.png\n--2020-03-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":40:20--  http://myminio.tonybai.com:9000/image/gopher-daily-logo.png\n正在解析主机 myminio.tonybai.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myminio.tonybai.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.12")]),t._v(".69.83\n正在连接 myminio.tonybai.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myminio.tonybai.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("106.12")]),t._v(".69.83"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(":9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". 已连接。\n已发出 HTTP 请求，正在等待回应"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n长度：59736 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("58K"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("image/png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n正在保存至: “gopher-daily-logo.png”\n\ngopher-daily-logo.png        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v(".34K   253KB/s  用时 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".2s   \n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-03-16 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":40:20 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("253")]),t._v(" KB/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" - 已保存 “gopher-daily-logo.png” "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59736")]),t._v("/59736"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"_4-开启多版本控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-开启多版本控制"}},[t._v("#")]),t._v(" 4 开启多版本控制")]),t._v(" "),a("p",[t._v("要开启多版本控制，必须开启纠删码模式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715165955626.png",alt:"image-20220715165955626"}})]),t._v(" "),a("p",[t._v("开启纠删码模式后，我们上传的文件可以看到历史版本")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715170326538.png",alt:"image-20220715170326538"}})]),t._v(" "),a("p",[t._v("我们再存储可以看到他的多版本文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/image-20220715170931323.png",alt:"image-20220715170931323"}})]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tonybai.com/2020/03/16/build-high-performance-object-storage-with-minio-part1-prototype/",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用minio搭建高性能对象存储-第一部分：原型"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);