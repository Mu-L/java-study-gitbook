(window.webpackJsonp=window.webpackJsonp||[]).push([[722],{1100:function(a,t,s){"use strict";s.r(t);var e=s(26),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"skywalking收集之grpc代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skywalking收集之grpc代理"}},[a._v("#")]),a._v(" SkyWalking收集之gRPC代理")]),a._v(" "),s("h2",{attrs:{id:"_1-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[a._v("#")]),a._v(" 1. 简介")]),a._v(" "),s("p",[a._v("在微服务体系中，各个微服务分布在各个服务器上，SkyWalking也不例外。如果能通过内网ip访问还好，但是如果 "),s("strong",[a._v("SkyWalking 和 应用服务器 之间网络不通")]),a._v("。那么他们之间如何建立关联。")]),a._v(" "),s("p",[a._v("我们首先肯定想到可以通过 nginx 代理到SkyWalking 服务器，但是实际代理过程中我们发现 skywalking-oap 收集采用的是gRPC代理，而不是基于 http。")]),a._v(" "),s("h2",{attrs:{id:"_2-解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-解决方案"}},[a._v("#")]),a._v(" 2. 解决方案")]),a._v(" "),s("p",[a._v("这里提供两个解决方案")]),a._v(" "),s("ul",[s("li",[a._v("通过nginx代理gRPC端口")]),a._v(" "),s("li",[a._v("使用natapp等内网穿透以tcp 方式代理")])]),a._v(" "),s("h3",{attrs:{id:"_2-1-通过nginx代理grpc端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-通过nginx代理grpc端口"}},[a._v("#")]),a._v(" 2.1 通过nginx代理gRPC端口")]),a._v(" "),s("h4",{attrs:{id:"_2-1-1-前置条件-nginx-支持http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-前置条件-nginx-支持http2"}},[a._v("#")]),a._v(" 2.1.1 前置条件，"),s("strong",[a._v("nginx 支持http2")])]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.hi-linux.com/posts/24162.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("nginx支持http2"),s("OutboundLink")],1)]),a._v(" "),s("h4",{attrs:{id:"_2-1-2-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-配置"}},[a._v("#")]),a._v(" 2.1.2 配置")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("  server {\n    listen 8022 http2;\n\n    location / {\n      grpc_pass grpc://localhost:11800; # 映射到SkyWalking的 gRPC 端口11800\n    }\n  }\n")])])]),s("h3",{attrs:{id:"_2-2-通过natapp等内网穿透以tcp-方式代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-通过natapp等内网穿透以tcp-方式代理"}},[a._v("#")]),a._v(" 2.2 通过natapp等内网穿透以tcp 方式代理")]),a._v(" "),s("h3",{attrs:{id:"_2-2-1-下载natapp并正确配置启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-下载natapp并正确配置启动"}},[a._v("#")]),a._v(" 2.2.1 下载natapp并正确配置启动")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://natapp.cn/article/natapp_newbie",target:"_blank",rel:"noopener noreferrer"}},[a._v("NATAPP1分钟快速新手图文教程"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_2-2-2-购买tcp隧道"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-购买tcp隧道"}},[a._v("#")]),a._v(" 2.2.2 购买tcp隧道")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200204210513387.png",alt:"image-20200204210513387"}})]),a._v(" "),s("h3",{attrs:{id:"_2-2-3-启动natapp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-启动natapp"}},[a._v("#")]),a._v(" 2.2.3 启动natapp")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./natapp -authtoken=1027bdec1c8d8709\n")])])]),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200204210720400.png",alt:"image-20200204210720400"}})]),a._v(" "),s("p",[a._v("上面启动是前台启动，关闭页面就停止了。所以需要使用后台启动")]),a._v(" "),s("p",[s("strong",[a._v("后台启动")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("nohup ./natapp -authtoken=d0ae75441459014e -log=stdout -loglevel=ERROR &\n")])])]),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200205131045127.png",alt:"image-20200205131045127"}})]),a._v(" "),s("p",[a._v("查看是否启动")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ps -ef|grep natapp\n")])])]),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200205132814470.png",alt:"image-20200205132814470"}})]),a._v(" "),s("h3",{attrs:{id:"_2-2-4-backend-service-地址更改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-backend-service-地址更改"}},[a._v("#")]),a._v(" 2.2.4 backend_service 地址更改")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("-Dskywalking.collector.backend_service=server.natappfree.cc:37444\n")])])]),s("p",[s("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20200204213810001.png",alt:"image-20200204213810001"}})]),a._v(" "),s("h2",{attrs:{id:"参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[a._v("#")]),a._v(" 参考文章")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.nginx.com/blog/nginx-1-13-10-grpc/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Introducing gRPC Support with NGINX 1.13.10"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.hi-linux.com/posts/24162.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("nginx支持http2"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://natapp.cn/",target:"_blank",rel:"noopener noreferrer"}},[a._v("natapp"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);