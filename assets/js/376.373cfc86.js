(window.webpackJsonp=window.webpackJsonp||[]).push([[376],{753:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch入门"}},[s._v("#")]),s._v(" Elasticsearch入门")]),s._v(" "),a("h2",{attrs:{id:"_1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1. 简介")]),s._v(" "),a("p",[s._v("Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎。 它能从项目一开始就赋予你的数据以搜索、分析和探索的能力，可用于实现全文搜索和实时数据统计。")]),s._v(" "),a("p",[s._v("它可以快速地储存、搜索和分析海量数据。维基百科、Stack Overflow、Github 都采用它。")]),s._v(" "),a("h2",{attrs:{id:"_2-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[s._v("#")]),s._v(" 2. 安装")]),s._v(" "),a("p",[a("a",{attrs:{href:"microservice/log/elk/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86"}},[s._v("安装参考")]),s._v(":")]),s._v(" "),a("p",[s._v("http://java.isture.com/microservice/log/elk/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86.html")]),s._v(" "),a("p",[s._v("通过docker 安装ELK")]),s._v(" "),a("h2",{attrs:{id:"_3-基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-基本概念"}},[s._v("#")]),s._v(" 3. 基本概念")]),s._v(" "),a("h3",{attrs:{id:"_3-1-node-与-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-node-与-cluster"}},[s._v("#")]),s._v(" 3.1 Node 与 Cluster")]),s._v(" "),a("p",[s._v("Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。")]),s._v(" "),a("p",[s._v("单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。")]),s._v(" "),a("h3",{attrs:{id:"_3-2-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-index"}},[s._v("#")]),s._v(" 3.2 Index")]),s._v(" "),a("p",[s._v("Elastic 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。")]),s._v(" "),a("p",[s._v("所以，Elastic 数据管理的顶层单位就叫做 Index（索引）。它是单个数据库的同义词。每个 Index （即数据库）的名字必须是小写。")]),s._v(" "),a("p",[s._v("下面的命令可以查看当前节点的所有 Index。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:9200/_cat/indices?v'")]),s._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://zszblog.oss-cn-beijing.aliyuncs.com/zszblog/blogimage-master/img/image-20201019140504439.png",alt:"image-20201019140504439"}})]),s._v(" "),a("h3",{attrs:{id:"_3-3-document"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-document"}},[s._v("#")]),s._v(" 3.3 Document")]),s._v(" "),a("p",[s._v("Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。")]),s._v(" "),a("p",[s._v("Document 使用 JSON 格式表示，下面是一个例子。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工程师"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"desc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库管理"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。")]),s._v(" "),a("h3",{attrs:{id:"_3-4-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-type"}},[s._v("#")]),s._v(" 3.4 Type")]),s._v(" "),a("p",[s._v("Document 可以分组，比如"),a("code",[s._v("weather")]),s._v("这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document。")]),s._v(" "),a("p",[s._v("不同的 Type 应该有相似的结构（schema），举例来说，"),a("code",[s._v("id")]),s._v("字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("一个区别"),a("OutboundLink")],1),s._v("。性质完全不同的数据（比如"),a("code",[s._v("products")]),s._v("和"),a("code",[s._v("logs")]),s._v("）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。")]),s._v(" "),a("p",[s._v("下面的命令可以列出每个 Index 所包含的 Type。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/_mapping?pretty=true'")]),s._v("\n")])])]),a("h2",{attrs:{id:"_4-新建和删除-index"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-新建和删除-index"}},[s._v("#")]),s._v(" 4. 新建和删除 Index")]),s._v(" "),a("p",[s._v("新建 Index，可以直接向 Elastic 服务器发出 PUT 请求。下面的例子是新建一个名叫"),a("code",[s._v("weather")]),s._v("的 Index。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/weather'")]),s._v("\n")])])]),a("p",[s._v("服务器返回一个 JSON 对象，里面的"),a("code",[s._v("acknowledged")]),s._v("字段表示操作成功。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"acknowledged"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shards_acknowledged"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("然后，我们发出 DELETE 请求，删除这个 Index。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X DELETE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/weather'")]),s._v("\n")])])]),a("h2",{attrs:{id:"_5-数据操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-数据操作"}},[s._v("#")]),s._v(" 5. 数据操作")]),s._v(" "),a("h3",{attrs:{id:"_5-1-新增记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-新增记录"}},[s._v("#")]),s._v(" 5.1 新增记录")]),s._v(" "),a("p",[s._v("向指定的 /Index/Type 发送 PUT 请求，就可以在 Index 里面新增一条记录。比如，向"),a("code",[s._v("/accounts/person")]),s._v("发送请求，就可以新增一条人员记录。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v("  -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" -X PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/1'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "user": "张三",\n  "title": "工程师",\n  "desc": "数据库管理"\n}\'')]),s._v(" \n")])])]),a("p",[s._v("服务器返回的 JSON 对象，会给出 Index、Type、Id、Version 等信息。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_shards"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"successful"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("如果你仔细看，会发现请求路径是"),a("code",[s._v("/accounts/person/1")]),s._v("，最后的"),a("code",[s._v("1")]),s._v("是该条记录的 Id。它不一定是数字，任意字符串（比如"),a("code",[s._v("abc")]),s._v("）都可以。")]),s._v(" "),a("p",[s._v("新增记录的时候，也可以不指定 Id，这时要改成 POST 请求。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "user": "李四",\n  "title": "工程师",\n  "desc": "系统管理"\n}\'')]),s._v("\n")])])]),a("p",[s._v("上面代码中，向"),a("code",[s._v("/accounts/person")]),s._v("发出一个 POST 请求，添加一个记录。这时，服务器返回的 JSON 对象里面，"),a("code",[s._v("_id")]),s._v("字段就是一个随机字符串。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AV3qGfrC6jMbsbXb6k1p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_shards"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"successful"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("注意，如果没有先创建 Index（这个例子是"),a("code",[s._v("accounts")]),s._v("），直接执行上面的命令，Elastic 也不会报错，而是直接生成指定的 Index。")]),s._v(" "),a("h3",{attrs:{id:"_5-2-查看记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-查看记录"}},[s._v("#")]),s._v(" 5.2 查看记录")]),s._v(" "),a("p",[s._v("向"),a("code",[s._v("/Index/Type/Id")]),s._v("发出 GET 请求，就可以查看这条记录。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/1?pretty=true'")]),s._v("\n")])])]),a("p",[s._v("上面代码请求查看"),a("code",[s._v("/accounts/person/1")]),s._v("这条记录，URL 的参数**"),a("code",[s._v("pretty=true")]),s._v("表示以易读的格式返回**。")]),s._v(" "),a("p",[s._v("返回的数据中，"),a("code",[s._v("found")]),s._v("字段表示查询成功，"),a("code",[s._v("_source")]),s._v("字段返回原始记录。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"found"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_source"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工程师"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"desc"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库管理"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("如果 Id 不正确，就查不到数据，"),a("code",[s._v("found")]),s._v("字段就是"),a("code",[s._v("false")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/weather/beijing/abc?pretty=true'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"found"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"_5-3-删除记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-删除记录"}},[s._v("#")]),s._v(" 5.3 删除记录")]),s._v(" "),a("p",[s._v("删除记录就是发出 DELETE 请求。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X DELETE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/1'")]),s._v("\n")])])]),a("h3",{attrs:{id:"_5-4-更新记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-更新记录"}},[s._v("#")]),s._v(" 5.4 更新记录")]),s._v(" "),a("p",[s._v("更新记录就是使用 PUT 请求，重新发送一次数据。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X PUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/1'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n    "user" : "张三",\n    "title" : "工程师",\n    "desc" : "数据库管理，软件开发"\n}\'')]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),s._v(":2,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"updated"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_shards"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),s._v(":2,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"successful"')]),s._v(":1,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),s._v(":0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),s._v(":false\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v('上面代码中，我们将原始数据从"数据库管理"改成"数据库管理，软件开发"。 返回结果里面，有几个字段发生了变化。')]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_version"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"result"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"updated"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])])]),a("p",[s._v("可以看到，记录的 Id 没变，但是版本（version）从"),a("code",[s._v("1")]),s._v("变成"),a("code",[s._v("2")]),s._v("，操作类型（result）从"),a("code",[s._v("created")]),s._v("变成"),a("code",[s._v("updated")]),s._v("，"),a("code",[s._v("created")]),s._v("字段变成"),a("code",[s._v("false")]),s._v("，因为这次不是新建记录。")]),s._v(" "),a("h2",{attrs:{id:"_6-数据查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-数据查询"}},[s._v("#")]),s._v(" 6. 数据查询")]),s._v(" "),a("h3",{attrs:{id:"_6-1-返回所有记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-返回所有记录"}},[s._v("#")]),s._v(" 6.1 返回所有记录")]),s._v(" "),a("p",[s._v("使用 GET 方法，直接请求"),a("code",[s._v("/Index/Type/_search")]),s._v("，就会返回所有记录。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"took"')]),s._v(":2,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timed_out"')]),s._v(":false,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_shards"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),s._v(":5,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"successful"')]),s._v(":5,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),s._v(":0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hits"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),s._v(":2,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_score"')]),s._v(":1.0,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hits"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AV3qGfrC6jMbsbXb6k1p"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_score"')]),s._v(":1.0,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"李四"')]),s._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工程师"')]),s._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"desc"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"系统管理"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_score"')]),s._v(":1.0,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),s._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工程师"')]),s._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"desc"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库管理，软件开发"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("上面代码中，返回结果的 "),a("code",[s._v("took")]),s._v("字段表示该操作的耗时（单位为毫秒），"),a("code",[s._v("timed_out")]),s._v("字段表示是否超时，"),a("code",[s._v("hits")]),s._v("字段表示命中的记录，里面子字段的含义如下。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("total")]),s._v("：返回记录数，本例是2条。")]),s._v(" "),a("li",[a("code",[s._v("max_score")]),s._v("：最高的匹配程度，本例是"),a("code",[s._v("1.0")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("hits")]),s._v("：返回的记录组成的数组。")])]),s._v(" "),a("p",[s._v("返回的记录中，每条记录都有一个"),a("code",[s._v("_score")]),s._v("字段，表示匹配的程序，默认是按照这个字段降序排列。")]),s._v(" "),a("h3",{attrs:{id:"_6-2-全文搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-全文搜索"}},[s._v("#")]),s._v(" 6.2 全文搜索")]),s._v(" "),a("p",[s._v("Elastic 的查询非常特别，使用自己的"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("查询语法"),a("OutboundLink")],1),s._v("，要求 GET 请求带有数据体。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query" : { "match" : { "desc" : "软件" }}\n}\'')]),s._v("\n")])])]),a("p",[s._v("上面代码使用 "),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Match 查询"),a("OutboundLink")],1),s._v("，指定的匹配条件是"),a("code",[s._v("desc")]),s._v('字段里面包含"软件"这个词。返回结果如下。')]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"took"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timed_out"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_shards"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"successful"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hits"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_score"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.28582606")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hits"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_index"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_score"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.28582606")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_source"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工程师"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"desc"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"数据库管理，软件开发"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("Elastic 默认一次返回10条结果，可以通过"),a("code",[s._v("size")]),s._v("字段改变这个设置。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query" : { "match" : { "desc" : "管理" }},\n  "size": 1\n}\'')]),s._v("\n")])])]),a("p",[s._v("上面代码指定，每次只返回一条结果。")]),s._v(" "),a("p",[s._v("还可以通过"),a("code",[s._v("from")]),s._v("字段，指定位移。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query" : { "match" : { "desc" : "管理" }},\n  "from": 1,\n  "size": 1\n}\'')]),s._v("\n")])])]),a("p",[s._v("上面代码指定，从位置1开始（默认是从位置0开始），只返回一条结果。")]),s._v(" "),a("h3",{attrs:{id:"_6-3-逻辑运算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-逻辑运算"}},[s._v("#")]),s._v(" 6.3 逻辑运算")]),s._v(" "),a("p",[s._v("如果有多个搜索关键字， Elastic 认为它们是"),a("code",[s._v("or")]),s._v("关系。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query" : { "match" : { "desc" : "软件 系统" }}\n}\'')]),s._v("\n")])])]),a("p",[s._v("上面代码搜索的是"),a("code",[s._v("软件 or 系统")]),s._v("。")]),s._v(" "),a("p",[s._v("如果要执行多个关键词的"),a("code",[s._v("and")]),s._v("搜索，必须使用"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("布尔查询"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/accounts/person/_search'")]),s._v("  -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "query": {\n    "bool": {\n      "must": [\n        { "match": { "desc": "软件" } },\n        { "match": { "desc": "系统" } }\n      ]\n    }\n  }\n}\'')]),s._v("\n")])])]),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("全文搜索引擎 Elasticsearch 入门教程"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);