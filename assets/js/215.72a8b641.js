(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{592:function(e,o,r){"use strict";r.r(o);var t=r(26),a=Object(t.a)({},(function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"mongodb异常关闭后-如何修复启动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mongodb异常关闭后-如何修复启动"}},[e._v("#")]),e._v(" mongodb异常关闭后，如何修复启动")]),e._v(" "),r("h2",{attrs:{id:"_1-背景"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-背景"}},[e._v("#")]),e._v(" 1. 背景")]),e._v(" "),r("p",[e._v("当独立的"),r("code",[e._v("mongod")]),e._v("实例禁用日记功能时，"),r("strong",[e._v("不正常的关闭可能会使数据处于不一致状态")]),e._v("。异常关闭后，如果存在非空的"),r("code",[e._v("mongod.lock")]),e._v("文件，则mongod实例在重新启动时记录以下消息：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("Detected unclean shutdown - mongod.lock is not empty.\n")])])]),r("p",[e._v("如果dbPath包含非空的"),r("code",[e._v("mongod.lock")]),e._v("文件，则必须修复数据库")]),e._v(" "),r("blockquote",[r("p",[e._v("不要使用本教程恢复"),r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/reference-glossary.html#term-replica-set",target:"_blank",rel:"noopener noreferrer"}},[e._v("replica set"),r("OutboundLink")],1),e._v("的成员。相反，您应该从"),r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/core-backups.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("backup"),r("OutboundLink")],1),e._v("恢复，或者从集合的另一个成员重新同步，如"),r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-resync-replica-set-member.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("重新同步副本集的成员"),r("OutboundLink")],1),e._v("中所述。")])]),e._v(" "),r("blockquote",[r("p",[e._v("默认情况下，MongoDB 在启用"),r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/core-journaling.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("journaling"),r("OutboundLink")],1),e._v("的情况下运行，以防止在关闭时出现数据不一致的情况。要彻底关闭，请参阅"),r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-manage-mongodb-processes.html#terminate-mongod-processes",target:"_blank",rel:"noopener noreferrer"}},[e._v("停止 mongod 进程"),r("OutboundLink")],1),e._v("。")])]),e._v(" "),r("h2",{attrs:{id:"_2-以-repair-启动-mongod"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-以-repair-启动-mongod"}},[e._v("#")]),e._v(" 2. 以--repair 启动 mongod")]),e._v(" "),r("p",[e._v("要修复数据文件，请使用"),r("code",[e._v("--repair")]),e._v("选项启动"),r("code",[e._v("mongod")]),e._v("实例。默认情况下，在修复操作期间，MongoDB 使用"),r("code",[e._v("--dbpath")]),e._v("中的"),r("code",[e._v("_tmp")]),e._v("目录。")]),e._v(" "),r("p",[e._v("发出类似于以下内容的命令：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("mongod --dbpath /data/db --repair\n")])])]),r("p",[e._v("完成后，"),r("code",[e._v("dbpath")]),e._v("应包含已修复的数据文件和一个空的"),r("code",[e._v("mongod.lock")]),e._v("文件。")]),e._v(" "),r("h2",{attrs:{id:"参考文章"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[e._v("#")]),e._v(" 参考文章")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/tutorial-recover-data-following-unexpected-shutdown.html#%E4%BB%A5--repair-%E5%90%AF%E5%8A%A8-mongod",target:"_blank",rel:"noopener noreferrer"}},[e._v("意外关闭后恢复独立服务器"),r("OutboundLink")],1)])])}),[],!1,null,null,null);o.default=a.exports}}]);