(window.webpackJsonp=window.webpackJsonp||[]).push([[231],{608:function(s,a,t){"use strict";t.r(a);var r=t(26),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mysql安装后登录异常-can-t-connect-to-local-mysql-server-through-socket-var-lib-mysql-mysql-sock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql安装后登录异常-can-t-connect-to-local-mysql-server-through-socket-var-lib-mysql-mysql-sock"}},[s._v("#")]),s._v(" Mysql安装后登录异常 Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock")]),s._v(" "),t("h2",{attrs:{id:"_1-背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-背景"}},[s._v("#")]),s._v(" 1. 背景")]),s._v(" "),t("p",[s._v("登录时")]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mysql -u root\n")])])]),t("p",[s._v("报错提示")]),s._v(" "),t("p",[s._v("ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)")]),s._v(" "),t("h2",{attrs:{id:"_2-解决思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-解决思路"}},[s._v("#")]),s._v(" 2. 解决思路")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("出现该问题后，首先根据错误提示我想到的是查看本地‘/var/lib/mysql/mysql.sock’文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /var/lib/mysql/mysql.sock\nls: 无法访问/var/lib/mysql/mysql.sock: 没有那个文件或目录\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查找本地是否有 mysql.sock")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("find / -name mysql.sock\n")])])]),t("p",[s._v("发现本地都没有mysql.sock文件。")])]),s._v(" "),t("li",[t("p",[s._v("如果没有 mysql.sock，可能是因为/var/lib/mysql 路径没有权限导致")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("解决方式：授权")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root /var/lib/mysql/\n")])])])]),s._v(" "),t("li",[t("p",[s._v("重启服务")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysqld restart\n")])])])]),s._v(" "),t("li",[t("p",[s._v("若还异常")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /var/lib/mysql\n")])])])])])]),s._v(" "),t("li",[t("p",[s._v("还有一种原因是，安装MySQL的时候自定义过socket文件保存路径，于是查看MySQL的配置文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf  \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/mysql.sock\n")])])]),t("p",[s._v("查看权限/var/lib/mysql/mysql.sock ,")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("srwxrwxrwx 1 mysql mysql 0 8月   6 20:57 /tmp/mysql.sock\n")])])]),t("p",[s._v('该文件为"777"权限，所以排除了因为文件权限导致该问题的可能。 综合上面的排查，大致可以确定导致该错误的原因是MySQL寻址没寻到/tmp/mysql.sock该文件，那么该如何解决该问题呢？')]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("解决办法")]),s._v("1：")]),s._v(" "),t("p",[s._v("既然是寻址问题，肯定是因为寻址路径原因， 再看错误提示“/var/lib/mysql/mysql.sock”，该路径就是在更改socket路径前的默认路径，文件不存在，说明该地址无效，那么只么MySQL能找道mysql.sock文件就可以啊，于是想到创建软链接：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@adailinux adaiblog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ln "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n")])])]),t("p",[s._v("创建完成后重启MySQL服务，再次执行mysql命令，问题解决。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("解决办法")]),s._v("2：")]),s._v(" "),t("p",[s._v("通过上述分析可以确定MySQL配置文件中所指定的socket路径没有生效，自我感觉这才是问题的本质原因，于是查找资料，进行如下操作：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@adailinux adaiblog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndatadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\nsocket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsocket"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n")])])]),t("p",[s._v("编辑MySQL配置文件后添加如上内容，重启MySQL服务，问题解决！")])])]),s._v(" "),t("h2",{attrs:{id:"参考文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1409771",target:"_blank",rel:"noopener noreferrer"}},[s._v("关于mysql.sock路径的问题"),t("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=e.exports}}]);